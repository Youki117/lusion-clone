# AI学习助手 - DeepSeek API 接入说明

## 功能概述

AI学习助手已成功接入DeepSeek API，提供智能的学习问答功能。系统支持两种模式：

1. **演示模式**：使用预设的模拟回复（无需API密钥）
2. **智能模式**：使用DeepSeek API提供真实的AI回答（需要API密钥）

## 功能特性

### ✅ 已实现功能

- **智能对话**：基于DeepSeek API的自然语言对话
- **上下文感知**：根据当前学习的知识点提供相关回答
- **学习建议**：AI生成个性化的学习建议
- **API密钥管理**：安全的密钥配置和存储
- **错误处理**：完善的错误提示和降级机制
- **状态指示**：清晰的连接状态显示

### 🔧 技术实现

- **DeepSeek API集成**：完全兼容OpenAI格式的API调用
- **智能降级**：API不可用时自动切换到演示模式
- **本地存储**：API密钥安全存储在浏览器本地
- **错误恢复**：网络错误时的自动重试机制

## 使用方法

### 1. 访问AI学习助手

访问教育页面：`http://localhost:3002/education?subject=physics`

在右侧面板中找到"AI学习助手"功能。

### 2. 配置API密钥（推荐）

#### 获取DeepSeek API密钥

1. 访问 [DeepSeek平台](https://platform.deepseek.com/api_keys)
2. 注册账号并登录
3. 创建新的API密钥
4. 复制密钥（格式：`sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`）

#### 在系统中配置密钥

1. 点击AI学习助手右上角的"设置"按钮（⚙️图标）
2. 在弹出的配置窗口中输入API密钥
3. 点击"保存并测试"按钮
4. 等待连接测试完成
5. 看到"API密钥配置成功！"提示后即可使用

### 3. 开始使用

配置完成后，您可以：

- **提问**：直接输入学习相关的问题
- **使用快捷操作**：点击"解释概念"、"举个例子"等快捷按钮
- **上下文学习**：选择知识点后，AI会基于该知识点回答问题

## 界面说明

### 状态指示器

- 🟢 **绿点**：API已连接，智能模式
- 🟡 **黄点**：演示模式，建议配置API密钥

### 按钮功能

- **⚙️ 设置**：配置API密钥
- **⋮ 更多**：显示/隐藏快捷操作
- **🎤 语音**：语音输入（待实现）
- **📎 附件**：文件上传（待实现）

## API配置详情

### 支持的模型

- **deepseek-chat**：通用对话模型（默认）
- **deepseek-reasoner**：推理模型（可选）

### API参数配置

```typescript
{
  model: "deepseek-chat",
  temperature: 0.7,        // 创造性程度
  max_tokens: 2048,        // 最大回复长度
  top_p: 0.9              // 核采样参数
}
```

### 系统提示词

AI助手使用专门为教育场景优化的系统提示词：

- 专业的学习助手身份
- 中文回答要求
- 根据知识点难度调整回答深度
- 鼓励性和引导性的回答风格

## 错误处理

### 常见错误及解决方案

1. **API密钥错误**
   - 错误信息：`API请求失败: 401`
   - 解决方案：检查API密钥是否正确，重新配置

2. **网络连接问题**
   - 错误信息：`请求失败: 网络错误`
   - 解决方案：检查网络连接，稍后重试

3. **API配额不足**
   - 错误信息：`API请求失败: 429`
   - 解决方案：检查DeepSeek账户余额或等待配额重置

### 降级机制

当API不可用时，系统会：

1. 显示错误提示
2. 自动切换到演示模式
3. 在回答末尾添加"演示模式"标识
4. 保持基本的对话功能

## 开发者信息

### 文件结构

```
src/
├── services/
│   ├── deepseekService.ts      # DeepSeek API服务
│   └── aiService.ts            # AI服务统一接口
├── components/ui/education/
│   ├── ApiKeyConfig.tsx        # API密钥配置组件
│   └── ChatInterface.tsx       # 聊天界面组件
└── types/
    └── index.ts                # 类型定义
```

### 环境变量（可选）

可以通过环境变量预设API密钥：

```bash
NEXT_PUBLIC_DEEPSEEK_API_KEY=sk-your-api-key-here
```

### 本地存储

API密钥存储在浏览器的localStorage中：

```javascript
localStorage.setItem('deepseek_api_key', 'your-api-key')
```

## 安全说明

1. **API密钥安全**：密钥仅存储在用户浏览器本地，不会发送到服务器
2. **HTTPS要求**：生产环境建议使用HTTPS确保传输安全
3. **密钥管理**：用户可随时清除或更新API密钥

## 后续扩展

### 计划中的功能

- **流式回复**：实时显示AI回答过程
- **语音交互**：语音输入和语音回复
- **文件上传**：支持图片和文档分析
- **多轮对话优化**：更好的上下文记忆
- **个性化学习**：基于学习历史的个性化建议

### 技术优化

- **缓存机制**：常见问题的回答缓存
- **负载均衡**：多API密钥轮询使用
- **性能监控**：API调用性能统计
- **A/B测试**：不同提示词效果对比

## 联系支持

如有问题或建议，请联系开发团队。

---

**注意**：请妥善保管您的API密钥，不要在公共场所或不安全的网络环境中输入密钥。
