# 🌐 球体知识图谱功能说明

## 📋 功能概述

本次更新将原有的平面圆形知识图谱升级为3D球体知识图谱，提供了更加立体和直观的知识结构可视化体验。

## ✨ 主要特性

### 1. 🌍 3D球体布局
- **真正的3D渲染**: 使用Three.js实现真正的3D球体渲染
- **球面节点分布**: 节点均匀分布在球体表面，避免平面布局的局限性
- **多层级结构**: 支持学科-章节-知识点的三层级结构展示

### 2. 🔄 双模式切换
- **简化模式**: 只显示必修1、必修2、必修3等大类模块
- **完全模式**: 显示具体章节和知识点的详细层级结构
- **平滑切换**: 模式切换时带有优雅的过渡动画效果

### 3. 🎯 智能布局算法
- **斐波那契螺旋分布**: 使用黄金角度实现最均匀的球面分布
- **防重叠算法**: 智能检测并避免节点重叠
- **多种分布模式**: 支持斐波那契、均匀随机、分层等多种分布算法

### 4. 🎮 丰富的交互体验
- **自由旋转**: 鼠标拖拽实现360度自由旋转
- **缩放控制**: 滚轮缩放，支持8-60倍距离范围
- **自动旋转**: 可选的自动旋转功能，展示全貌
- **节点交互**: 悬停显示详情，点击触发事件

### 5. 🎨 视觉效果优化
- **星空背景**: 沉浸式的星空背景效果
- **多重光照**: 环境光、方向光、点光源、聚光灯组合
- **材质效果**: 支持发光、透明、金属质感等材质效果
- **参考网格**: 可选的球体网格作为空间参考

## 🏗️ 技术架构

### 核心组件
```
SphereKnowledgeGraph3D (主组件)
├── SphereScene (3D场景)
│   ├── Node3D (3D节点组件)
│   ├── Stars (星空背景)
│   ├── 光照系统
│   └── OrbitControls (交互控制)
├── 模式切换控制
├── 悬停信息面板
└── 操作说明面板
```

### 数据结构
```typescript
interface KnowledgeNode {
  id: string
  name: string
  type: 'subject' | 'chapter' | 'knowledge_point' | 'module'
  level: number
  color: string
  size: number
  position: { x: number; y: number; z: number }
  description?: string
  difficulty?: 'basic' | 'intermediate' | 'advanced'
  status?: 'completed' | 'in_progress' | 'not_started'
  moduleType?: 'required' | 'elective'
  moduleNumber?: number
}
```

## 🎯 使用方法

### 1. 基本使用
```tsx
import { SphereKnowledgeGraph3D } from '@/components/ui/education/SphereKnowledgeGraph3D'

<SphereKnowledgeGraph3D
  subject={mathSubject}
  onNodeClick={handleNodeClick}
  onNodeHover={handleNodeHover}
  viewMode="simple"
  onViewModeChange={setViewMode}
/>
```

### 2. 集成到现有系统
在 `KnowledgeGraphViewer` 组件中已经集成了球体视图：
- 通过视图类型切换按钮选择"球体视图"
- 在球体视图下可以切换"简化模式"和"完全模式"

### 3. 测试页面
访问 `/test-sphere` 页面可以独立测试球体知识图谱功能

## 📊 数据支持

### 数学学科详细数据
- **必修一**: 集合与常用逻辑用语、函数概念与性质、指数函数与对数函数、三角函数
- **必修二**: 立体几何初步、平面解析几何初步
- **选择性必修一**: 空间向量与立体几何、直线和圆的方程、圆锥曲线的方程
- **选择性必修二**: 等式与不等式、数列、一元函数的导数及其应用
- **选择性必修三**: 计数原理、概率、统计

### 知识点详细映射
每个章节都有对应的具体知识点，例如：
- 集合与常用逻辑用语 → 集合的概念、集合的表示、集合间的关系、集合的运算
- 函数概念与性质 → 函数的概念、函数的表示、函数的性质、反函数

## 🔧 配置选项

### 布局算法配置
- `distributionType`: 'fibonacci' | 'uniform' | 'layered'
- `minDistance`: 节点间最小距离
- `radius`: 球体半径
- `level`: 层级偏移

### 视觉效果配置
- 光照强度和颜色
- 材质属性（透明度、发光强度等）
- 动画参数（旋转速度、过渡时间等）

## 🚀 性能优化

1. **智能渲染**: 使用React.memo和useCallback优化渲染性能
2. **节点限制**: 合理控制节点数量，避免性能问题
3. **异步加载**: 使用Suspense实现异步组件加载
4. **GPU加速**: 利用WebGL进行GPU加速渲染

## 🎨 视觉设计

### 颜色系统
- **学科主色**: 每个学科使用独特的品牌色
- **状态指示**: 🟢 已完成 / 🟡 学习中 / ⚪ 未开始
- **难度等级**: 🟢 基础 / 🟡 中等 / 🔴 高级

### 节点大小
- **学科节点**: 2.0 (中心最大)
- **模块/章节节点**: 1.2-1.5 (中等)
- **知识点节点**: 0.8 (最小)

## 🔮 未来扩展

1. **VR/AR支持**: 支持虚拟现实和增强现实设备
2. **物理引擎**: 添加物理碰撞和重力效果
3. **动态数据**: 支持实时数据更新和动画
4. **多学科联动**: 支持跨学科知识点关联显示
5. **个性化定制**: 用户自定义颜色、布局等视觉效果

## 📱 兼容性

- **浏览器**: Chrome 80+, Firefox 75+, Safari 13+, Edge 80+
- **设备**: 支持桌面端和移动端
- **性能**: 建议使用独立显卡以获得最佳体验

## 🔧 问题修复记录

### ✅ 已修复的问题

1. **动画速度过快问题**
   - 球体知识图谱旋转速度从0.5降低到0.1
   - 星空背景改为静态显示，移除闪烁动画
   - 电子轨道速度降低80%以上
   - 添加动画开关，用户可选择静态或动态模式

2. **版本兼容性问题**
   - 解决React Three Fiber版本冲突
   - 创建CSS 3D替代方案，避免WebGL依赖
   - 使用动态导入避免SSR问题

3. **控制台警告修复**
   - 添加suppressHydrationWarning修复服务端渲染警告
   - 优化组件加载方式

### 🎮 新增功能

1. **动画控制开关**
   - 用户可以在简化模式面板中切换自动旋转
   - 默认关闭动画，提供更稳定的体验
   - 保留动画选项供需要的用户使用

2. **性能优化**
   - 静态星空背景，减少CPU使用
   - 可控制的动画系统
   - 更好的内存管理

## 🐛 已知问题

1. 在低端设备上可能出现性能问题（已大幅改善）
2. 某些移动浏览器的WebGL支持有限（已提供CSS 3D替代方案）
3. 浏览器扩展可能导致控制台错误（不影响功能）

## 📞 技术支持

如有问题或建议，请联系开发团队或在项目仓库提交Issue。
